<%- include('../templates/header'); -%>

<!-- The title -->
<h1 style="text-align: center">Graph Chart of Contestants</h1>

<!-- The canvas -->
<canvas id="voteChart" style="height: 50vh; width: 100vw"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
	// Initialize the canvas
	const ctx = document.getElementById('voteChart').getContext('2d');

	// Initialize the chart
	const chart = new Chart(ctx, {
		type: 'bar',
		data: {
			labels: ['Candidates'],
		},
		options: {},
	});

	const socket = io();

	function randomRGB() {
		const r = () => (Math.random() * 256) >> 0;
		return `rgb(${r()}, ${r()}, ${r()})`;
	}

	// On new vote update the chart
	socket.on('update', (candidates) => {
		candidates = Object.entries(candidates);
		// For each candidate
		for (const [key, candidate] of candidates) {
			// Update the vote if the candidate already exists if not create a new candidate and then update the vote
			if (
				typeof chart.data.datasets[key] == 'undefined' &&
				chart.data.datasets.length < candidates.length
			) {
				chart.data.datasets.push({
					backgroundColor: randomRGB(),
					borderColor: randomRGB(),
					data: [candidate.Vote],
					label: candidate.User,
				});
			} else if (typeof chart.data.datasets[key] != 'undefined') {
				chart.data.datasets[key].data = [candidate.Vote];
			}
		}

		// Update the chart
		chart.update();
	});
</script>

<%- include('../templates/footer'); -%>
